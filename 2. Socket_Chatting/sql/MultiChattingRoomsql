CREATE TABLE MULTICHATTINGROOM (
    MULTICHATTINGROOM_ID INT PRIMARY KEY,
    MULTIROOMNAME VARCHAR2(100) NOT NULL
);

CREATE SEQUENCE MULTICHATTINGROOM_SEQ START WITH 1 INCREMENT BY 1 NOCACHE;






-- 1대1 채팅방 조회

SELECT 
    'SINGLE' AS ROOM_TYPE,
    C.CHATTINGROOM_ID AS ROOM_ID,
    C.ROOMNAME AS ROOM_NAME,
    CASE WHEN L.UNAME = ? THEN U2.NICKNAME ELSE U1.NICKNAME END AS PARTICIPANTS,
    2 AS USER_COUNT
FROM CHATTINGROOM C
JOIN CHATTINGLIST L ON C.CHATTINGROOM_ID = L.CHATTINGROOM_ID
JOIN MEMBER U1 ON L.UNAME1 = U1.ID
JOIN MEMBER U2 ON L.UNAME2 = U2.ID
WHERE L.UNAME1 = ? OR L.NAME2 = ?

UNION ALL
-- 멀티채팅방 조회

SELECT 
    'MULTI' AS ROOM_TYPE,
    M.MULTICHATTINGROOM_ID AS ROOM_ID,
    M.MULTIROOMNAME AS ROOM_NAME,
    LISTAGG(U.NICKNAME, ', ') WITHIN GROUP (ORDER BY U.NICKNAME) AS PARTICIPANTS,
    COUNT(L.UID) AS USER_COUNT
FROM MULTICHATTINGROOM M
JOIN MULTICHATTINGLIST L ON M.MULTICHATTINGROOM_ID = L.MULTICHATTINGROOM_ID
JOIN MEMBER U ON L.UID = U.ID
WHERE L.MULTICHATTINGROOM_ID IN (
    SELECT MULTICHATTINGROOM_ID FROM MULTICHATTINGLIST WHERE UID = ?
)
GROUP BY M.MULTICHATTINGROOM_ID, M.MULTIROOMNAME
ORDER BY ROOM_ID;